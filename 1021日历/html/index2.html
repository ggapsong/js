<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../style/index.css">
    <script src="../../global/miaov.js"></script>
</head>

<body>
    <div class="wrap">
        <div class="top">
        </div>
        <div class="middle">
            <div class="left">
                <div class="select">
                    <div class="prev">
                        <img src="../img/pic_03.png" alt="">
                    </div>
                    <div class="date">

                    </div>
                    <div class="next">
                        <img src="../img/pic_05.png" alt="">
                    </div>
                </div>
                <div class="big_box">
                    <div class="title">
                        <span>日</span>
                        <span>一</span>
                        <span>二</span>
                        <span>三</span>
                        <span>四</span>
                        <span>五</span>
                        <span>六</span>
                    </div>
                    <div class="calendar">
                        <div class="inactivity">30</div>
                    </div>
                </div>
                <div class="Month_box">
                    <div>一月</div>
                    <div>二月</div>
                    <div>三月</div>
                    <div>四月</div>
                    <div>五月</div>
                    <div>六月</div>
                    <div>七月</div>
                    <div>八月</div>
                    <div>九月</div>
                    <div>十月</div>
                    <div>十一月</div>
                    <div>十二月</div>
                </div>
                <div class="year_box"></div>
            </div>
            <div class="right">
                <div class="circular">
                    <div class="H"></div>
                    <div class="M"></div>
                    <div class="S"></div>
                    <div class="dot"></div>
                </div>
                <div class="time">
                    <span class="APM"></span>
                    <span class="NTime"></span>
                </div>
            </div>
        </div>
        <div class="bottom">
            <div>更改日期和时间设置...</div>
        </div>
    </div>
</body>
<script>
    let type = "days";


    //日历本历
    Calendar(2018, 10)

    function Calendar(year, month) {
        let calendar = document.querySelector(".calendar");
        let firstDay = new Date(year, month - 1, 1).getDay(); //当月1号是周几
        let lastMonthNum = new Date(year, month - 1, 0).getDate(); //上月的总天数
        let totle = new Date(year, month, 0).getDate() //当月的总天数
        let lastMonthFirst = lastMonthNum - firstDay + 1; //上个月在这个列表中需要显示的第一天是几号;
        let str = "";
        let nowMonthFirst = 1;
        let nextMonthFirst = 1;
        let data = new Date();
        let nowyear = data.getFullYear();
        let nowmon = data.getMonth() + 1;
        console.log(nowmon);
        let nowdata = data.getDate();
        for (let i = 0; i < 42; i++) {
            if (i < firstDay) { //显示上一个月
                str += `<div class="inactivity">${lastMonthFirst}</div>`;
                lastMonthFirst++
            } else if (nowMonthFirst <= totle) { //显示当前月
                if (nowyear == year && nowmon == month && nowdata == nowMonthFirst) {
                    str += `<div class="active">${nowMonthFirst}</div>`;
                } else {
                    str += `<div>${nowMonthFirst}</div>`;
                }
                nowMonthFirst++
            } else {
                str += `<div class="inactivity">${nextMonthFirst}</div>`;
                nextMonthFirst++
            }
        }
        calendar.innerHTML = str;
    };
    //点击下一张

    next()

    function next() {
        let big_box = document.querySelector(".big_box");
        let Month_box = document.querySelector(".Month_box");
        let year_box = document.querySelector(".year_box");
        let div = Month_box.querySelectorAll("div");
        let date = document.querySelector(".date");
        let next = document.querySelector(".next");
        let prev = document.querySelector(".prev");
        let nowTime = new Date();
        year = nowTime.getFullYear();
        mon = twoDouble(nowTime.getMonth() + 1);
        let calendar = document.querySelector(".calendar");
        let everyDay = calendar.querySelectorAll("div"); //每一天
        date.innerHTML = nowTime.getFullYear() + "年" + twoDouble(nowTime.getMonth() + 1) + "月"
        //点击下一个月
        next.onclick = function () {
            if (type == "days") {
                mon++
                if (mon > 12) {
                    year++;
                    mon = 1;
                }
                date.innerHTML = year + "年" + mon + "月";
                Calendar(year, mon);
            } else if (type == "month") {
                if (year == 2099) {
                    return
                }
                year++
                date.innerHTML = year + "年";
            }
            donghua(-210);
        };
        prev.onclick = function () {
            if (type == "days") {
                mon--;
                if (mon < 1) {
                    year--
                    mon = 12;
                }
                date.innerHTML = year + "年" + mon + "月";
                Calendar(year, mon);
            } else if (type == "month") {
                if (year == 1900) {
                    return
                };
                year--
                date.innerHTML = year + "年";
            };
            donghua(210);
        };
        date.onclick = function () {
            typechange();
            if (type == "month") {
                big_box.style.display = "none";
                Month_box.style.display = "block";
                date.innerHTML = year + "年";
            } else if (type == "year") {
                Month_box.style.display = "none";
                year_box.style.display = "block";
                yearRender(year_box, year);
            };
        }
        div.forEach((e, i) => {
            e.onclick = function () {
                mon = i + 1;
                big_box.style.display = "block";
                Month_box.style.display = 'none';
                Calendar(year, mon);
                date.innerHTML = year + "年" + mon + "月";
                type = 'days';
            };
        });

        function donghua(num) {
            mTween({
                el: Month_box,
                attr: {
                    left: num,
                },
                time: 100,
                cb: function () {
                    mTween({
                        el: Month_box,
                        attr: {
                            left: 0,
                        },
                        time: 100,
                    })
                }
            });
        };
        //当点击哪一年的时侯

        year_box.onclick = function () {
            let everyYear = document.querySelectorAll(".year_box div");
            console.log(everyYear);
            everyYear.forEach(item => {
                item.onclick = function () {
                    year_box.style.display = "none";
                    Month_box.style.display = 'block';
                    date.innerHTML = item.innerHTML + "年";
                    type = 'month';
                }
            })
        }
    }

    function typechange() {
        switch (type) {
            case "days":
                type = "month";
                break;
            case "month":
                type = "year";
                break;
            case "year":
                type = "years";
                break;
        }
    }

    toptime()

    function toptime() {
        //最上面的年月日周
        let top = document.querySelector(".top");
        let nowTime = new Date();
        top.innerHTML = nowTime.getFullYear() + "年" + twoDouble(nowTime.getMonth() + 1) + "月" + twoDouble(nowTime.getDate()) +
            "日" + "  " + handleWeek(nowTime.getDay());
    }
    //星期
    function handleWeek(num) {
        return ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'][num]
    }
    //表盘
    clock()
    setInterval(clock, 1000)

    function clock() {
        let H = document.querySelector(".H");
        let M = document.querySelector(".M");
        let S = document.querySelector(".S");
        let NTime = document.querySelector(".NTime"); //具体时间
        let date = new Date();
        let s = date.getSeconds();
        let m = date.getMinutes() + s / 60;
        let h = date.getHours() + m / 60;
        css(H, "rotate", 30 * h);
        css(M, "rotate", 6 * m);
        css(S, "rotate", 6 * s);
    }
    //表盘下的时间
    setInterval(timing, 1000);
    timing()

    function timing() {
        let nowTime = new Date();
        let APM = document.querySelector(".APM"); //
        let NTime = document.querySelector(".NTime"); //具体时间
        let Hours = nowTime.getHours();
        let Minutes = nowTime.getMinutes();
        let Seconds = nowTime.getSeconds();
        NTime.innerHTML = Hours + ':' + twoDouble(Minutes) + ':' + twoDouble(Seconds);
        APM.innerHTML = handleWeek(nowTime.getDay());
    }
    //补0
    function twoDouble(num) {
        return num < 10 ? "0" + num : "" + num;
    }
    //年份的生成
    function yearRender(el, year) {
        year = Number((year + '').slice(0, 3) + '0');
        var str = '<div style="color:#ccc;">' + (year - 1) + '</div>';
        for (let i = 0; i < 10; i++) {
            str += '<div>' + (year + i) + '</div>';
        };
        str += '<div style="color:#ccc;">' + (year + 10) + '</div>';
        el.innerHTML = str;
        document.querySelector('.date').innerHTML = year + '-' + (year + 10);

    }
</script>

</html>